<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost Settings</title>
    <style>
        body { font-family: var(--vscode-font-family); font-size: var(--vscode-font-size); color: var(--vscode-foreground); background-color: var(--vscode-editor-background); padding: 20px; }
        h1 { font-size: 24px; margin-bottom: 20px; }
        h2 { font-size: 18px; margin-top: 30px; margin-bottom: 10px; color: var(--vscode-textLink-foreground); }
        .tabs { display: flex; border-bottom: 1px solid var(--vscode-panel-border); margin-bottom: 20px; }
        .tab { padding: 10px 20px; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom-color: var(--vscode-textLink-foreground); color: var(--vscode-textLink-foreground); }
        .tab:hover { background-color: var(--vscode-editor-lineHighlightBackground); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid var(--vscode-panel-border); }
        th { background-color: var(--vscode-editor-lineHighlightBackground); font-weight: bold; }
        button { background-color: var(--vscode-button-background); color: var(--vscode-button-foreground); border: none; padding: 8px 16px; cursor: pointer; margin-right: 5px; }
        button:hover { background-color: var(--vscode-button-hoverBackground); }
        input[type="text"] { background-color: var(--vscode-input-background); color: var(--vscode-input-foreground); border: 1px solid var(--vscode-input-border); padding: 5px 10px; width: 100%; }
        .icon-preview { font-size: 24px; display: inline-block; width: 40px; text-align: center; }
        .mark-row { margin-bottom: 10px; padding: 10px; background-color: var(--vscode-editor-lineHighlightBackground); border-radius: 5px; }
        .mark-row input { margin: 5px 0; }
        .reset-button { background-color: var(--vscode-errorForeground); }
    </style>
</head>
<body>
    <h1>ğŸ‘» Ghost in the VSC - Settings</h1>
    
    <div class="tabs">
        <div class="tab active" data-tab="allmarks">All Marks</div>
        <div class="tab" data-tab="config">Mark Config</div>
        <div class="tab" data-tab="history">History</div>
        <div class="tab" data-tab="support">ğŸ’ Support</div>
    </div>
    
    <div id="allmarks-tab" class="tab-content active">
        <h2>ğŸ“š All Marks List</h2>
        
        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div style="margin-bottom: 20px; padding: 10px; background-color: var(--vscode-editor-lineHighlightBackground); border-radius: 5px;">
            <div style="margin-bottom: 10px;">
                <label>Sort by: </label>
                <select id="sort-select">
                    <option value="created">Created Time (Newest)</option>
                    <option value="priority">Priority (Highest)</option>
                    <option value="key">Key (A-Z)</option>
                </select>
                
                <label style="margin-left: 20px;">
                    <input type="checkbox" id="show-completed"> Show Completed
                </label>
            </div>
            
            <div style="margin-bottom: 10px;">
                <label>Filter by Key: </label>
                <div id="key-filter" style="display: inline-block;"></div>
            </div>
            
            <div>
                <input type="text" id="search-box" placeholder="Search by name, note, or symbol..." style="width: 50%;">
            </div>
        </div>
        
        <!-- ãƒãƒ¼ã‚¯ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
        <div id="allmarks-content"><p>No marks yet. Click on a line and press a-z to create marks.</p></div>
    </div>
    
    <div id="config-tab" class="tab-content">
        <h2>âš™ï¸ Mark Configuration (a-z)</h2>
        <p>Customize icon, label, and color for each key.</p>
        <div id="config-content"></div>
        <button id="reset-marks" class="reset-button">Reset to Defaults</button>
    </div>
    
    <div id="history-tab" class="tab-content">
        <h2>Command History</h2>
        <div id="history-content"><p>No command history yet</p></div>
    </div>
    
    <div id="support-tab" class="tab-content">
        <h2>ğŸ’ Support This Project</h2>
        <div style="padding: 20px; background-color: var(--vscode-editor-lineHighlightBackground); border-radius: 10px; max-width: 600px;">
            <p style="font-size: 16px; margin-bottom: 20px;">
                GhostMarkDown is a free extension with patented technology. If you find it useful, please consider supporting its development!
            </p>
            
            <p style="font-size: 16px; margin-bottom: 20px;">
                GhostMarkDownã¯ç‰¹è¨±æŠ€è¡“ã‚’ä½¿ç”¨ã—ãŸç„¡æ–™æ‹¡å¼µæ©Ÿèƒ½ã§ã™ã€‚ä¾¿åˆ©ã ã¨æ„Ÿã˜ãŸã‚‰ã€é–‹ç™ºã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ï¼
            </p>
            
            <div style="text-align: center; margin: 30px 0;">
                <a href="https://buymeacoffee.com/ogiharadevelopment" 
                   style="display: inline-block; padding: 15px 30px; background-color: #FFDD00; color: #000; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 18px;">
                    â˜• Buy Me a Coffee
                </a>
            </div>
            
            <p style="margin-top: 30px; font-size: 14px; opacity: 0.8;">
                Your support helps maintain and improve this extension. Thank you! ğŸ™<br>
                ã‚ãªãŸã®ã‚µãƒãƒ¼ãƒˆãŒã“ã®æ‹¡å¼µæ©Ÿèƒ½ã®ç¶­æŒã¨æ”¹å–„ã«å½¹ç«‹ã¡ã¾ã™ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ğŸ™
            </p>
            
            <div style="margin-top: 40px; padding: 20px; background-color: var(--vscode-inputValidation-errorBackground); border: 1px solid var(--vscode-inputValidation-errorBorder); border-radius: 8px;">
                <h3 style="color: var(--vscode-inputValidation-errorForeground); margin-top: 0;">âš ï¸ ç‰¹è¨±ä¿è­·ã«é–¢ã™ã‚‹é‡è¦ãªãŠçŸ¥ã‚‰ã› / Patent Protection Notice</h3>
                
                <div style="margin-bottom: 20px;">
                    <h4 style="color: var(--vscode-inputValidation-errorForeground); margin-bottom: 10px;">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</h4>
                    <p style="font-size: 14px; line-height: 1.6; margin-bottom: 15px;">
                        ã“ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ç‰¹è¨±æŠ€è¡“ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã‚´ãƒ¼ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æŠ€è¡“ã¯æŸ»å®šæ¸ˆã¿ç‰¹è¨±ã«ã‚ˆã‚Šä¿è­·ã•ã‚Œã¦ãŠã‚Šã€é–¢é€£ã™ã‚‹å‘¨è¾ºæŠ€è¡“ã«ã¤ã„ã¦ã‚‚å‡ºé¡˜ä¸­ã®ç‰¹è¨±ãŒã‚ã‚Šã¾ã™ã€‚
                    </p>
                    <p style="font-size: 14px; line-height: 1.6; margin-bottom: 15px;">
                        <strong>å•†ç”¨åˆ©ç”¨åˆ¶é™ï¼š</strong><br>
                        â€¢ ã“ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯<strong>å€‹äººåˆ©ç”¨ãŠã‚ˆã³æ•™è‚²ç›®çš„ã®ã¿</strong>ã§MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™<br>
                        â€¢ <strong>å•†ç”¨åˆ©ç”¨ã€å†é…å¸ƒã€æ´¾ç”Ÿä½œå“ã®ä½œæˆã¯æ˜ç¤ºçš„ãªæ›¸é¢ã«ã‚ˆã‚‹è¨±å¯ãªã—ã«ã¯ç¦æ­¢</strong>ã•ã‚Œã¦ã„ã¾ã™<br>
                        â€¢ ç„¡è¨±å¯ã®å•†ç”¨åˆ©ç”¨ã¯ç‰¹è¨±ä¾µå®³ã®ç”³ã—ç«‹ã¦ã®å¯¾è±¡ã¨ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
                    </p>
                </div>
                
                <div>
                    <h4 style="color: var(--vscode-inputValidation-errorForeground); margin-bottom: 10px;">ğŸ‡ºğŸ‡¸ English</h4>
                    <p style="font-size: 14px; line-height: 1.6; margin-bottom: 15px;">
                        This extension implements patented technology. The Ghost Interface technology is protected by issued patents, with additional patents pending for related features.
                    </p>
                    <p style="font-size: 14px; line-height: 1.6; margin-bottom: 15px;">
                        <strong>Commercial Use Restrictions:</strong><br>
                        â€¢ This software is provided under MIT License for <strong>personal and educational use only</strong><br>
                        â€¢ <strong>Commercial use, redistribution, or derivative works are prohibited</strong> without explicit written permission<br>
                        â€¢ Any unauthorized commercial use may result in patent infringement claims
                    </p>
                    <p style="font-size: 14px; line-height: 1.6; margin-bottom: 10px;">
                        <strong>For Commercial Licensing:</strong><br>
                        Contact: isaoogihara@ogiharadevelopment.net
                    </p>
                    <p style="font-size: 14px; line-height: 1.6; margin: 0;">
                        <strong>Patent Information:</strong><br>
                        â€¢ Issued Patent: Ghost Interface Technology<br>
                        â€¢ Pending Patents: Related peripheral technologies
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        (function() {
            const vscode = acquireVsCodeApi();
            let allMarks = [];
            let customMarks = [];
            let selectedKeys = [];
            
            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById(tabName + '-tab').classList.add('active');
                });
            });
            
            // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
            document.getElementById('reset-marks').addEventListener('click', () => {
                vscode.postMessage({ command: 'resetMarks' });
            });
            
            // ã‚½ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
            document.getElementById('sort-select').addEventListener('change', refreshAllMarks);
            document.getElementById('show-completed').addEventListener('change', refreshAllMarks);
            document.getElementById('search-box').addEventListener('input', refreshAllMarks);
            
            // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            vscode.postMessage({ command: 'load' });
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
            window.addEventListener('message', event => {
                const message = event.data;
                if (message.command === 'loaded') {
                    customMarks = message.customMarks || [];
                    allMarks = message.allMarks || [];
                    renderCustomMarks(customMarks);
                    renderKeyFilter(customMarks);
                    renderAllMarks(allMarks);
                    renderHistory(message.history || []);
                }
            });
            
            function renderKeyFilter(configs) {
                const filter = document.getElementById('key-filter');
                let html = '';
                configs.forEach(config => {
                    html += `<label style="margin-right: 10px;">
                        <input type="checkbox" class="key-checkbox" value="${config.key}">
                        ${config.key.toUpperCase()}
                    </label>`;
                });
                filter.innerHTML = html;
                
                // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆ
                filter.querySelectorAll('.key-checkbox').forEach(cb => {
                    cb.addEventListener('change', function() {
                        if (this.checked) {
                            selectedKeys.push(this.value);
                        } else {
                            selectedKeys = selectedKeys.filter(k => k !== this.value);
                        }
                        refreshAllMarks();
                    });
                });
            }
            
            function refreshAllMarks() {
                const sortBy = document.getElementById('sort-select').value;
                const showCompleted = document.getElementById('show-completed').checked;
                const searchText = document.getElementById('search-box').value;
                
                vscode.postMessage({
                    command: 'filterMarks',
                    sortBy: sortBy,
                    showCompleted: showCompleted,
                    filterKeys: selectedKeys.length > 0 ? selectedKeys : null,
                    searchText: searchText
                });
            }
            
            function renderAllMarks(marks) {
                const content = document.getElementById('allmarks-content');
                if (!marks || marks.length === 0) {
                    content.innerHTML = '<p>No marks found.</p>';
                    return;
                }
                
                let html = '<table><tr><th>Key</th><th>Name</th><th>Priority</th><th>File:Line</th><th>Note</th><th>Created</th><th>Status</th><th>Actions</th></tr>';
                marks.forEach(mark => {
                    const config = customMarks.find(c => c.key === mark.key) || { icon: mark.key, label: mark.key };
                    const fileName = mark.uri.split('/').pop();
                    const created = new Date(mark.created).toLocaleString();
                    const statusIcon = mark.completed ? 'âœ…' : 'â³';
                    const priorityStars = 'â­'.repeat(mark.priority);
                    
                    html += `<tr>
                        <td>${config.icon} <small>${mark.key}</small></td>
                        <td><strong>${mark.name}</strong></td>
                        <td>${priorityStars} (${mark.priority})</td>
                        <td><small>${fileName}:${mark.line + 1}</small></td>
                        <td><small>${mark.note || '-'}</small></td>
                        <td><small>${created}</small></td>
                        <td>${statusIcon}</td>
                        <td>
                            <button onclick="jumpToMark('${mark.id}')">Jump</button>
                            <button onclick="deleteMark('${mark.id}')">Delete</button>
                        </td>
                    </tr>`;
                });
                html += '</table>';
                content.innerHTML = html;
            }
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆonclickç”¨ï¼‰
            window.jumpToMark = function(id) {
                vscode.postMessage({ command: 'jumpToMark', markId: id });
            };
            
            window.deleteMark = function(id) {
                vscode.postMessage({ command: 'deleteMark', markId: id });
            };
            
            function renderCustomMarks(marks) {
                const content = document.getElementById('config-content');
                let html = '';
                
                marks.forEach(mark => {
                    html += `
                        <div class="mark-row">
                            <strong>Key: ${mark.key.toUpperCase()}</strong>
                            <div style="display: flex; gap: 10px; align-items: center; margin-top: 5px;">
                                <span class="icon-preview">${mark.icon}</span>
                                <div style="flex: 1;">
                                    <input type="text" value="${mark.icon}" data-key="${mark.key}" data-field="icon" placeholder="Icon (emoji)">
                                    <input type="text" value="${mark.label}" data-key="${mark.key}" data-field="label" placeholder="Label">
                                    <input type="text" value="${mark.color}" data-key="${mark.key}" data-field="color" placeholder="Color (hex)">
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                content.innerHTML = html;
                
                // å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ
                content.querySelectorAll('input').forEach(input => {
                    input.addEventListener('change', function() {
                        const key = this.getAttribute('data-key');
                        const field = this.getAttribute('data-field');
                        const value = this.value;
                        vscode.postMessage({
                            command: 'updateMarkConfig',
                            key: key,
                            field: field,
                            value: value
                        });
                        
                        // ã‚¢ã‚¤ã‚³ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
                        if (field === 'icon') {
                            const preview = this.parentElement.parentElement.querySelector('.icon-preview');
                            preview.textContent = value;
                        }
                    });
                });
            }
            
            function renderHistory(history) {
                const content = document.getElementById('history-content');
                if (!history || history.length === 0) {
                    content.innerHTML = '<p>No command history yet</p>';
                } else {
                    let html = '<table><tr><th>Command</th><th>Count</th><th>Last Used</th></tr>';
                    history.forEach(item => {
                        const date = new Date(item.lastUsed);
                        html += `<tr>
                            <td>${item.command}</td>
                            <td>${item.count}</td>
                            <td>${date.toLocaleString()}</td>
                        </tr>`;
                    });
                    html += '</table>';
                    content.innerHTML = html;
                }
            }
        })();
    </script>
</body>
</html>
