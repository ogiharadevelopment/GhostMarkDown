# 👻 CodeLens方式 - テスト手順

## ✅ 実装内容

あなたの要望通り：

1. ✅ 関数などをクリックすると、左側に**👻アイコン**（CodeLens）が表示される
2. ✅ その👻アイコンにマウスホバーすると、**ショートカット一覧**が表示される
3. ✅ ホバー中にキーを押すと、**文字入力を防いで**アクションを実行

---

## 🚀 準備

```bash
npm run compile
code .
# F5キーで起動
```

---

## 🧪 テスト1: 👻アイコンの表示

### 手順

1. 拡張機能開発ホストで `test-samples/sample.js` を開く

2. 関数宣言を見つける:
```javascript
5 | function myTestFunction() {
```

3. `myTestFunction` の上または中をクリック

### 期待される結果

**関数名の左側に👻アイコンが表示される:**

```javascript
👻 function myTestFunction() {
^--- ここにCodeLensとして表示
    console.log('Hello, Ghost in the VSC!');
}
```

- ✅ 👻アイコンが関数名の左側に表示される
- ✅ アイコンはクリック可能
- ✅ 他の関数にも同様に表示される

✅ **合格** / ❌ **不合格**

---

## 🧪 テスト2: 👻アイコンにホバー

### 手順

1. テスト1の状態から続行（👻アイコンが表示されている）
2. **👻アイコンにマウスをホバー**（関数名ではなく、その左の👻に）

### 期待される結果

**ホバー情報が表示される:**

```
┌─────────────────────────────────────┐
│ 👻 Ghost in the VSC                │
│                                     │
│ myTestFunction (function)           │
│ ─────────────────────────────────   │
│ キーを押してショートカット実行:      │
│                                     │
│ • D: 定義へジャンプ (F12)           │
│ • R: 参照を表示 (Shift+F12)        │
│ • H: 呼び出し階層 (Shift+Alt+H)    │
│ • N: 名前を変更 (F2)               │
│ • P: 定義をプレビュー (Alt+F12)    │
│ • C: コメントを追加                 │
│ ─────────────────────────────────   │
│ ホバー中です。キーを押すと          │
│ 即座に実行されます。                │
└─────────────────────────────────────┘
```

✅ **合格** / ❌ **不合格**

---

## 🧪 テスト3: キー入力でアクション実行

### 手順

1. 👻アイコンにホバー（ホバー情報が表示されている）
2. **Rキー**を押す

### 期待される結果

- ✅ 参照パネルが開く
- ✅ `myTestFunction` の使用箇所が一覧表示される
- ✅ **重要**: エディタに「R」という文字が入力されていない
- ✅ 通知が表示される

✅ **合格** / ❌ **不合格**

---

## 🧪 テスト4: 変数での動作確認

### 手順

1. 変数宣言を見つける:
```javascript
13 | const myVariable = 42;
```

2. `myVariable` をクリックまたはカーソルを置く
3. 左側に👻アイコンが表示されることを確認
4. 👻アイコンにホバー

### 期待される結果

**コンテキストが「variable」:**

```
👻 Ghost in the VSC

myVariable (variable)
───────────────────────
• D: 定義へジャンプ
• R: 参照を表示
• N: 名前を変更
• T: 型定義へジャンプ
```

✅ **合格** / ❌ **不合格**

---

## 🧪 テスト5: クラスでの動作確認

### 手順

1. クラス宣言を見つける:
```javascript
22 | class MyTestClass {
```

2. 👻アイコンにホバー

### 期待される結果

**コンテキストが「class」:**

```
👻 Ghost in the VSC

MyTestClass (class)
───────────────────────
• D: 定義へジャンプ
• R: 参照を表示
• I: 実装へジャンプ
• N: 名前を変更
• M: メンバー一覧
```

✅ **合格** / ❌ **不合格**

---

## 📊 テスト結果まとめ

| テスト | 内容 | 結果 |
|--------|------|------|
| 1 | 👻アイコンの表示 | ✅/❌ |
| 2 | 👻アイコンにホバー | ✅/❌ |
| 3 | キー入力でアクション実行 | ✅/❌ |
| 4 | 変数での動作確認 | ✅/❌ |
| 5 | クラスでの動作確認 | ✅/❌ |

**合格数:** ___ / 5

---

## 💡 使い方

### 基本フロー

```
1. 関数などをクリック
   ↓
2. 左側に👻アイコンが表示される
   ↓
3. 👻アイコンにマウスホバー
   ↓
4. ホバー情報が表示される
   ↓
5. キーを押す（D, R, H, N, P, C）
   ↓
6. アクションが実行される
   （文字入力されない）
```

---

## 🎯 重要なポイント

### ✅ 成功のサイン

1. **👻アイコンが表示される**
   - 関数、変数、クラスの左側
   - CodeLensとして常に表示

2. **ホバーで情報表示**
   - 👻アイコンにホバーで表示
   - 関数名自体ではない

3. **キー入力が防がれる**
   - Rキーを押しても「R」が入力されない
   - アクションが即座に実行される

---

## 🐛 トラブルシューティング

### 問題1: 👻アイコンが表示されない

**確認ポイント:**
- ✅ CodeLensが有効になっていますか？
  - VS Codeの設定: `"editor.codeLens": true`
- ✅ 拡張機能が有効ですか？（`Ctrl+Shift+G`で確認）
- ✅ JavaScriptまたはTypeScriptファイルですか？

### 問題2: ホバー情報が表示されない

**確認ポイント:**
- ✅ 👻アイコン自体にホバーしていますか？（関数名ではない）
- ✅ 正確に👻の上にマウスカーソルがありますか？

### 問題3: キーを押しても何も起こらない

**原因:**
- キー入力の監視がまだ完全には統合されていない可能性

**暫定対処:**
- QuickPick方式（`Ctrl+Shift+Space`）を使用

---

## 🎨 他の方式との比較

| 方式 | 操作 | メリット | デメリット |
|------|------|---------|----------|
| **CodeLens（今回）** | クリック → 👻にホバー → キー | 視覚的に分かりやすい | CodeLensの表示が必要 |
| 1行上ホバー | 1行上にホバー → キー | 関数名を邪魔しない | 1行上という位置が分かりにくい |
| QuickPick | `Ctrl+Shift+Space` | キーボードのみで完結 | ショートカットキーを覚える必要 |

---

## 🎉 まとめ

この方式の利点：

✅ **視覚的に分かりやすい**
- 👻アイコンが常に表示されている
- どこにホバーすれば良いかが明確

✅ **直感的**
- クリック → ホバー → キー
- 自然な操作フロー

✅ **編集の邪魔にならない**
- CodeLensは折りたたみ可能
- 必要ない時は非表示にできる

---

試してみて、フィードバックをお願いします！

**次のステップ:**
- キー入力監視の完全統合（現在は部分的）
- CodeLensのカスタマイズオプション追加
- 他の言語への対応拡張





