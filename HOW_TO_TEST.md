# Ghost in the VSC - テスト実行手順書

この手順書に従って、拡張機能を実際にテストしてください。

## 📋 前提条件の確認

- [ ] Node.js v18以上がインストールされている
- [ ] VS Code v1.85.0以上がインストールされている
- [ ] Git がインストールされている

確認コマンド:
```bash
node --version  # v18以上
code --version  # 1.85.0以上
```

## 🚀 セットアップ（初回のみ）

### 1. 依存関係のインストール

```bash
# プロジェクトのルートディレクトリで実行
npm install
```

**期待される結果:**
```
added XXX packages in XXs
```

### 2. TypeScriptのコンパイル

```bash
npm run compile
```

**期待される結果:**
```
(エラーなしでコンパイル完了)
```

**エラーが出た場合:**
- TypeScriptがインストールされているか確認: `npm list typescript`
- 再度インストール: `npm install --save-dev typescript`

## 🧪 拡張機能の起動

### 方法1: VS Code内から起動（推奨）

1. VS Codeでこのプロジェクトフォルダを開く
   ```bash
   code .
   ```

2. **F5キー**を押す

3. 新しいウィンドウ「**[拡張機能開発ホスト]**」が開く

4. タイトルバーに「[拡張機能開発ホスト]」と表示されていることを確認

### 方法2: コマンドから起動

1. `Ctrl+Shift+D`（Macは`Cmd+Shift+D`）でデバッグビューを開く
2. ドロップダウンで「**拡張機能を実行**」を選択
3. 緑の**▶ボタン**をクリック

## ✅ 基本動作テスト

### テスト1: 拡張機能が読み込まれているか確認

**手順:**

1. [拡張機能開発ホスト]ウィンドウで
2. `Ctrl+Shift+P`（Macは`Cmd+Shift+P`）でコマンドパレットを開く
3. 「Ghost」と入力

**期待される結果:**
```
✓ "Ghost in the VSC: 有効/無効を切り替え" が表示される
✓ "Ghost in the VSC: ガイドを表示" が表示される
```

**結果:** ✅合格 / ❌不合格

---

### テスト2: サンプルファイルを開く

**手順:**

1. [拡張機能開発ホスト]ウィンドウで
2. `Ctrl+O`（Macは`Cmd+O`）でファイルを開く
3. `test-samples/sample.js` を選択

**期待される結果:**
```
✓ sample.js が開かれる
✓ シンタックスハイライトが表示される
```

**結果:** ✅合格 / ❌不合格

---

### テスト3: ゴーストインジケーターの表示

**手順:**

1. `sample.js`の5行目にある`myTestFunction`の上にカーソルを置く
   - `function myTestFunction()` の`myTestFunction`の任意の文字の上

2. 1行上（4行目）を見る

**期待される結果:**
```
✓ 関数名の1行上に赤い点（🔴）が4つ表示される
✓ 四隅に配置されている（左上、右上、左下、右下）
✓ 点は小さい（4px程度）
```

**実際の見え方:**
```
   3 | // ========================================
   4 | 🔴                               🔴  ← ここに赤い点
   5 | function myTestFunction() {
   4 | 🔴                               🔴  ← ここに赤い点
   6 |     console.log('Hello, Ghost in the VSC!');
```

**表示されない場合のトラブルシューティング:**

A. 拡張機能を有効化:
```
Ctrl+Shift+G で有効/無効を切り替え
```

B. 開発者ツールでエラー確認:
```
Ctrl+Shift+I を押してConsoleタブを確認
```

C. 拡張機能を再起動:
```
[拡張機能開発ホスト]ウィンドウを閉じてF5を再度押す
```

**結果:** ✅合格 / ❌不合格

---

### テスト4: ホバーで色が変わる

**手順:**

1. テスト3の状態から続行（赤い点が表示されている）
2. マウスカーソルを赤い点の近く（1行上の行）に移動
3. ホバーする

**期待される結果:**
```
✓ 赤い点（🔴）が黄色（🟡）に変わる
✓ 点が少し大きくなる（5-6px程度）
✓ 点の周りが光る（グローエフェクト）
✓ 薄い半透明の背景が表示される
```

**結果:** ✅合格 / ❌不合格

---

### テスト5: ガイドパレットの表示

**手順:**

1. テスト4の状態から続行（黄色い点が表示されている）
2. マウスを動かさずに**約0.2秒（200ms）待つ**

**期待される結果:**
```
✓ ガイドパレットが表示される
✓ パレットは半透明の暗い背景
✓ 以下の内容が表示される:
  - [function] myTestFunction  ← ヘッダー
  - D  定義へジャンプ
  - R  参照を表示
  - H  呼び出し階層
  - N  名前を変更
  - C  コメントを追加
  - T  テストを生成
```

**実際の見え方:**
```
┌─────────────────────────────┐
│ [function] myTestFunction   │
│                             │
│ [D]  定義へジャンプ         │
│ [R]  参照を表示            │
│ [H]  呼び出し階層          │
│ [N]  名前を変更            │
│ [C]  コメントを追加         │
│ [T]  テストを生成          │
└─────────────────────────────┘
```

**結果:** ✅合格 / ❌不合格

---

### テスト6: ショートカットキーの実行

**手順:**

1. テスト5の状態から続行（ガイドパレットが表示されている）
2. キーボードで**Dキー**を押す

**期待される結果:**
```
✓ 「定義へジャンプ」が実行される
✓ カーソルが関数定義の位置に移動（すでにそこにいるので変化なし）
✓ 通知メッセージが表示される:
  "ショートカット実行: D (myTestFunction)"
✓ ガイドパレットが非表示になる
```

**結果:** ✅合格 / ❌不合格

---

### テスト7: 参照の表示（R キー）

**手順:**

1. `myTestFunction`にカーソルを置く
2. ゴースト → ホバー → ガイド表示
3. **Rキー**を押す

**期待される結果:**
```
✓ 参照パネル（References）が開く
✓ myTestFunction の使用箇所が一覧表示される
✓ 最低でも1箇所は表示される（sample.js内の呼び出し）
```

**結果:** ✅合格 / ❌不合格

---

### テスト8: 名前の変更（N キー）

**手順:**

1. `myTestFunction`にカーソルを置く
2. ゴースト → ホバー → ガイド表示
3. **Nキー**を押す

**期待される結果:**
```
✓ リネームモードになる
✓ 関数名がハイライトされる
✓ すべての参照箇所もハイライトされる
✓ 入力できる状態になる
```

**実際に試す:**
- 「myRenamedFunction」と入力
- Enterを押す
- すべての箇所が変更されることを確認

**元に戻す:** `Ctrl+Z`

**結果:** ✅合格 / ❌不合格

---

### テスト9: 変数でのテスト

**手順:**

1. `sample.js`の12行目`const myVariable = 42;`の`myVariable`にカーソル
2. ゴースト → ホバー → ガイド表示

**期待される結果:**
```
✓ ガイドの内容が変わる:
  [variable] myVariable
  D  定義へジャンプ
  R  参照を表示
  N  名前を変更
  T  型定義へジャンプ
```

**結果:** ✅合格 / ❌不合格

---

### テスト10: クラスでのテスト

**手順:**

1. `sample.js`の22行目`class MyTestClass`の`MyTestClass`にカーソル
2. ゴースト → ホバー → ガイド表示

**期待される結果:**
```
✓ ガイドの内容が変わる:
  [class] MyTestClass
  D  定義へジャンプ
  R  参照を表示
  I  実装へジャンプ
  N  名前を変更
  M  メンバー一覧
```

**結果:** ✅合格 / ❌不合格

---

## 🔥 高度なテスト

### テスト11: エラー波線でのクイックフィックス

**手順:**

1. `sample.js`の85行目のコメントを外す:
   ```javascript
   const errorTest = undefinedVariable + 1;
   ```

2. `undefinedVariable`に赤い波線が表示される
3. カーソルを`undefinedVariable`の上に置く
4. ゴースト → ホバー → ガイド表示
5. **Fキー**を押す

**期待される結果:**
```
✓ クイックフィックスメニューが開く
✓ 修正候補が表示される
```

**結果:** ✅合格 / ❌不合格

---

### テスト12: TypeScriptファイルでのテスト

**手順:**

1. `test-samples/sample.ts`を開く
2. `calculateSum`関数にカーソルを置く
3. ゴースト → ホバー → ガイド表示
4. **Tキー**を押す（型定義へジャンプ）

**期待される結果:**
```
✓ 型定義（number）にジャンプする
```

**結果:** ✅合格 / ❌不合格

---

### テスト13: 設定の変更

**手順:**

1. `Ctrl+,`で設定を開く
2. 「Ghost in the VSC」で検索
3. `Corner Indicator Size`を**6**に変更
4. サンプルファイルに戻る
5. ゴーストを表示

**期待される結果:**
```
✓ 赤い点が大きくなる（6px）
```

**結果:** ✅合格 / ❌不合格

---

### テスト14: ガイド表示遅延の変更

**手順:**

1. 設定で`Hover Delay`を**500**に変更
2. サンプルファイルに戻る
3. ゴースト → ホバー
4. タイマーで計測

**期待される結果:**
```
✓ ガイドが約0.5秒（500ms）後に表示される
```

**結果:** ✅合格 / ❌不合格

---

## 📊 テスト結果まとめ

| テスト番号 | テスト内容 | 結果 |
|-----------|----------|------|
| 1 | 拡張機能が読み込まれているか | ✅/❌ |
| 2 | サンプルファイルを開く | ✅/❌ |
| 3 | ゴーストインジケーターの表示 | ✅/❌ |
| 4 | ホバーで色が変わる | ✅/❌ |
| 5 | ガイドパレットの表示 | ✅/❌ |
| 6 | ショートカットキーの実行（D） | ✅/❌ |
| 7 | 参照の表示（R） | ✅/❌ |
| 8 | 名前の変更（N） | ✅/❌ |
| 9 | 変数でのテスト | ✅/❌ |
| 10 | クラスでのテスト | ✅/❌ |
| 11 | エラー波線でのクイックフィックス | ✅/❌ |
| 12 | TypeScriptファイルでのテスト | ✅/❌ |
| 13 | 設定の変更（サイズ） | ✅/❌ |
| 14 | 設定の変更（遅延） | ✅/❌ |

**合格数:** __ / 14

---

## 🐛 よくある問題と解決策

### 問題1: 赤い点が表示されない

**原因と解決策:**

1. 拡張機能が無効:
   ```
   Ctrl+Shift+G で有効化
   ```

2. コンパイルエラー:
   ```bash
   npm run compile
   # エラーを確認して修正
   ```

3. Webviewが初期化されていない:
   ```
   拡張機能開発ホストを再起動
   ```

### 問題2: ガイドが表示されない

**原因と解決策:**

1. ホバー時間が短い:
   ```
   200ms（0.2秒）待つ
   ```

2. マウスが動いている:
   ```
   マウスを止めて待つ
   ```

3. Webviewのエラー:
   ```
   Ctrl+Shift+P → "Developer: Open Webview Developer Tools"
   ```

### 問題3: キーが反応しない

**原因と解決策:**

1. フォーカスが外れている:
   ```
   エディタをクリックしてフォーカス
   ```

2. キーバインドの競合:
   ```
   他の拡張機能を無効化して試す
   ```

### 問題4: 位置がずれる

**現在の制限事項:**
- VS Code APIの制限により、正確なピクセル位置を取得できない
- 将来のバージョンで改善予定

**一時的な対処:**
- エディタのフォントサイズを調整
- `cornerIndicatorSize`を変更

---

## 🎉 テスト完了

すべてのテストが合格したら、拡張機能は正常に動作しています！

**次のステップ:**
- 実際の開発ワークフローで使用してみる
- フィードバックを収集
- 新しい機能のアイデアを提案

**問題がある場合:**
- GitHubでissueを作成
- 開発者ツールのログを添付
- 再現手順を詳しく記載

---

**テスト実施日:** _______________

**テスト実施者:** _______________

**総合評価:** ✅合格 / ❌不合格 / ⚠️要改善




